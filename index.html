<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ƒå¤§å¯è½‰å‚µè³‡æ–™æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .upload-box {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            font-weight: bold;
        }

        .file-input-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .file-name {
            color: #495057;
            font-size: 14px;
        }

        .update-time {
            margin-left: auto;
            color: #6c757d;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 14px;
        }

        .filter-group input,
        .filter-group select {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-buttons {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
            white-space: nowrap;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 15px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .positive {
            color: #dc3545;
        }

        .negative {
            color: #28a745;
        }

        .new-listing {
            color: #dc3545;
            font-weight: bold;
        }

        /* é€£çµhoveræ•ˆæœ */
        a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .highlight {
            background: #fff3cd !important;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .change {
            font-size: 14px;
            opacity: 0.8;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .no-data {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #667eea;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-wrap: nowrap;
            }

            .filters {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px;">
                <span style="font-size: 42px;">ğŸ¯</span>
                <h1 style="margin: 0; font-size: 36px; font-weight: 700;">å…ƒå¤§å¯è½‰å‚µæŸ¥è©¢ç³»çµ±</h1>
            </div>
            <p style="color: rgba(255,255,255,0.95); font-size: 16px; margin: 15px 0; font-weight: 500;">
                ç«¶æ‹çµ±è¨ˆæ•¸æ“š | æ™ºèƒ½æ¨¡æ“¬åˆ†æ | æŠ•æ¨™åƒ¹æ ¼è©¦ç®—
            </p>
            <div style="display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap; margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.25); padding: 10px 20px; border-radius: 25px; font-size: 15px; display: flex; align-items: center; gap: 8px;">
                    <span>ğŸ“…</span>
                    <span id="current-date"></span>
                </div>
                <a href="https://vocus.cc/user/@rexlife" target="_blank" style="background: rgba(255,255,255,0.25); padding: 10px 20px; border-radius: 25px; font-size: 15px; text-decoration: none; color: white; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <span>ğŸ“</span>
                    <span>æ–¹æ ¼å­éƒ¨è½æ ¼</span>
                </a>
                <a href="https://www.youtube.com/@RexCFP" target="_blank" style="background: rgba(255,255,255,0.25); padding: 10px 20px; border-radius: 25px; font-size: 15px; text-decoration: none; color: white; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <span>â–¶ï¸</span>
                    <span>YouTubeé »é“</span>
                </a>
            </div>
            <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin-top: 15px;">
                by Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤
            </p>
            
            <!-- ç€è¦½é‡çµ±è¨ˆ -->
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 15px; font-size: 14px;">
                <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 15px;">
                    <span>ğŸ‘ï¸ ä»Šæ—¥ç€è¦½: </span>
                    <span id="today-views" style="font-weight: 600;">0</span>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 15px;">
                    <span>ğŸ“Š ç´¯ç©ç€è¦½: </span>
                    <span id="total-views" style="font-weight: 600;">0</span>
                </div>
            </div>
        </div>

        <!-- è³‡æ–™æœŸé–“è³‡è¨Šæ¢ -->
        <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); padding: 12px 20px; margin: 20px 0; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <span style="color: #2d3436; font-size: 15px; font-weight: 600;">
                ğŸ“Š è³‡æ–™æ›´æ–°æ—¥æœŸï¼š<span id="data-period">è¼‰å…¥ä¸­...</span>
            </span>
        </div>

        <div class="upload-section">
            <div class="upload-box">
                <div style="display: flex; align-items: center; gap: 20px; width: 100%;">
                    <div style="flex: 1;">
                        <strong style="color: #667eea;">ğŸ“Š è³‡æ–™ä¾†æºï¼š</strong>
                        <span id="data-source">è‡ªå‹•è¼‰å…¥ä¸­...</span>
                    </div>
                    <span class="update-time" id="update-time"></span>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="quote">å³æ™‚å ±åƒ¹</button>
            <button class="tab" data-tab="primary">åˆç´šå¸‚å ´</button>
            <button class="tab" data-tab="issued">å·²ç™¼è¡Œæ¡ˆä»¶</button>
            <button class="tab" data-tab="filter">å ±åƒ¹ç¯©é¸å™¨</button>
            <button class="tab" data-tab="redeem">è´–å›è³‡è¨Š</button>
            <button class="tab" data-tab="stop">åœæ­¢è½‰æ›</button>
            <button class="tab" data-tab="balance">æµé€šé¤˜é¡</button>
            <button class="tab" data-tab="adjust">åƒ¹æ ¼èª¿æ•´</button>
            <button class="tab" data-tab="daily">æ¯æ—¥è¡Œæƒ…</button>
        </div>

        <!-- å³æ™‚å ±åƒ¹ -->
        <div id="quote" class="tab-content active">
            <div class="stats-grid" id="stats-grid"></div>
            <div class="table-wrapper">
                <table id="quote-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">ä»£ç¢¼</th>
                            <th style="width: 80px;">åç¨±</th>
                            <th style="width: 80px;">ç”¢æ¥­</th>
                            <th style="width: 70px;">æ¬Šåˆ©é‡‘</th>
                            <th style="width: 70px;">ç¾è‚¡åƒ¹</th>
                            <th style="width: 70px;">è½‰æ›åƒ¹</th>
                            <th style="width: 70px;">è½‰æ›å€¼</th>
                            <th style="width: 70px;">CBåƒè€ƒåƒ¹</th>
                            <th style="width: 80px;">æº¢æŠ˜åƒ¹%</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€é«˜</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€ä½</th>
                            <th style="width: 70px;">é«˜ä½æŒ¯å¹…%</th>
                            <th style="width: 80px;">æ³¢å‹•ç‡120å¤©</th>
                            <th style="width: 70px;">å‰©é¤˜å¹´æœŸ</th>
                            <th style="width: 90px;">è³£å›æ—¥</th>
                            <th style="width: 80px;">ä¿¡è©•</th>
                        </tr>
                    </thead>
                    <tbody id="quote-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- åˆç´šå¸‚å ´ -->
        <div id="primary" class="tab-content">
            <div class="alert alert-info">
                <span>ğŸ’¡</span>
                <div>
                    <strong>åˆç´šå¸‚å ´è³‡è¨Šï¼š</strong>å³å°‡ç™¼è¡Œæˆ–æ­£åœ¨è©¢åœˆ/ç«¶æ‹çš„å¯è½‰å‚µæ¡ˆä»¶
                </div>
            </div>
            <div class="table-wrapper">
                <table id="primary-table">
                    <thead>
                        <tr>
                            <th>æ¨™çš„ä»£è™Ÿ</th>
                            <th>ç™¼è¡Œæ¨™çš„</th>
                            <th>è©¢åœˆ/ç«¶æ‹</th>
                            <th>TCRI/æ“”ä¿</th>
                            <th>ç™¼è¡Œé‡(å„„)</th>
                            <th>ä¸»è¾¦åˆ¸å•†</th>
                            <th>ç”Ÿæ•ˆæ—¥</th>
                            <th>è©¢åœˆ/æŠ•æ¨™æœŸé–“</th>
                            <th>æº¢åƒ¹ç‡</th>
                            <th>è½‰æ›åƒ¹æ ¼</th>
                            <th>æ›ç‰Œæ—¥</th>
                            <th>æ‰¿éŠ·åƒ¹æ ¼</th>
                            <th>å¹´æœŸ</th>
                            <th>è³£å›æ¢ä»¶</th>
                            <th>å‚™è¨»</th>
                        </tr>
                    </thead>
                    <tbody id="primary-tbody"></tbody>
                </table>
            </div>
            
            <div class="alert alert-info" style="margin-top: 30px;">
                <span>ğŸ“¢</span>
                <div>
                    <strong>è‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶ï¼š</strong>å·²é€šéè‘£äº‹æœƒä½†å°šæœªé€ä»¶æˆ–ç”Ÿæ•ˆçš„å¯è½‰å‚µæ¡ˆä»¶
                </div>
            </div>
            <div class="table-wrapper">
                <table id="board-table">
                    <thead>
                        <tr>
                            <th>CBä»£ç¢¼</th>
                            <th>ç™¼è¡Œæ¨™çš„</th>
                            <th>TCRI/æ“”ä¿</th>
                            <th>ç™¼è¡Œé‡(å„„)</th>
                            <th>ä¸»è¾¦åˆ¸å•†</th>
                            <th>åˆ°æœŸæ—¥</th>
                            <th>è‘£äº‹æœƒé€šéæ—¥</th>
                            <th>æº¢åƒ¹ç‡</th>
                            <th>è½‰æ›åƒ¹æ ¼</th>
                            <th>å‚™è¨»</th>
                        </tr>
                    </thead>
                    <tbody id="board-tbody">
                        <tr><td colspan="10" class="no-data">ç›®å‰ç„¡è‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- å·²ç™¼è¡Œæ¡ˆä»¶ -->
        <div id="issued" class="tab-content">
            <div class="alert alert-info">
                <span>ğŸ“‹</span>
                <div>
                    <strong>æ­·å²ç™¼è¡Œè¨˜éŒ„ï¼š</strong>å·²å®Œæˆç™¼è¡Œçš„å¯è½‰å‚µæ¡ˆä»¶è³‡æ–™ <span id="issued-date-range" style="color: #667eea;"></span>
                </div>
            </div>
            
            <div class="filters">
                <div class="filter-group">
                    <label>ç™¼è¡Œæ¨™çš„</label>
                    <input type="text" id="issued-filter-name" placeholder="è¼¸å…¥é—œéµå­—æœå°‹">
                </div>
                <div class="filter-group">
                    <label>TCRI/æ“”ä¿</label>
                    <select id="issued-filter-tcri">
                        <option value="">å…¨éƒ¨</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ä¸»è¾¦åˆ¸å•†</label>
                    <select id="issued-filter-broker">
                        <option value="">å…¨éƒ¨åˆ¸å•†</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>å¹´æœŸ</label>
                    <select id="issued-filter-years">
                        <option value="">å…¨éƒ¨å¹´æœŸ</option>
                        <option value="3">3å¹´æœŸ</option>
                        <option value="5">5å¹´æœŸ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>é¡åº¦ç¯„åœ(å„„)</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="number" id="issued-filter-amount-min" placeholder="æœ€å°" style="width: 70px;">
                        <span style="line-height: 40px;">~</span>
                        <input type="number" id="issued-filter-amount-max" placeholder="æœ€å¤§" style="width: 70px;">
                    </div>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="applyIssuedFilters()">å¥—ç”¨ç¯©é¸</button>
                    <button class="btn btn-secondary" onclick="resetIssuedFilters()">é‡è¨­</button>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table id="issued-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">ä»£ç¢¼</th>
                            <th style="width: 100px;">ç™¼è¡Œæ¨™çš„</th>
                            <th style="width: 90px;">TCRI/æ“”ä¿</th>
                            <th style="width: 70px; cursor: pointer;" onclick="sortIssuedTable('é¡åº¦(å„„å…ƒ)')" title="é»æ“Šæ’åº">
                                é¡åº¦(å„„) <span id="sort-amount">â‡…</span>
                            </th>
                            <th style="width: 90px;">ä¸»è¾¦åˆ¸å•†</th>
                            <th style="width: 90px; cursor: pointer;" onclick="sortIssuedTable('é€ä»¶æ—¥')" title="é»æ“Šæ’åº">
                                é€ä»¶æ—¥ <span id="sort-senddate">â‡…</span>
                            </th>
                            <th style="width: 90px; cursor: pointer;" onclick="sortIssuedTable('ç”Ÿæ•ˆæ—¥')" title="é»æ“Šæ’åº">
                                ç”Ÿæ•ˆæ—¥ <span id="sort-effectdate">â‡…</span>
                            </th>
                            <th style="width: 90px;">è©¢åœˆæœŸé–“</th>
                            <th style="width: 70px; cursor: pointer;" onclick="sortIssuedTable('æº¢åƒ¹ç‡')" title="é»æ“Šæ’åº">
                                æº¢åƒ¹ç‡ <span id="sort-premium">â‡…</span>
                            </th>
                            <th style="width: 70px;">è½‰æ›åƒ¹æ ¼</th>
                            <th style="width: 90px; cursor: pointer;" onclick="sortIssuedTable('æ›ç‰Œæ—¥æœŸ')" title="é»æ“Šæ’åº">
                                æ›ç‰Œæ—¥æœŸ <span id="sort-listdate">â‡…</span>
                            </th>
                            <th style="width: 70px;">æ‰¿éŠ·åƒ¹æ ¼</th>
                            <th style="width: 60px;">å¹´æœŸ</th>
                            <th style="min-width: 150px;">è³£å›æ¢ä»¶</th>
                        </tr>
                    </thead>
                    <tbody id="issued-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- å ±åƒ¹ç¯©é¸å™¨ -->
        <div id="filter" class="tab-content">
            <div class="filters">
                <div class="filter-group">
                    <label>ç”¢æ¥­</label>
                    <select id="filter-industry">
                        <option value="">å…¨éƒ¨ç”¢æ¥­</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>æº¢æŠ˜åƒ¹% (æœ€å°)</label>
                    <input type="number" id="filter-premium-min" placeholder="ä¾‹: -10">
                </div>
                <div class="filter-group">
                    <label>æº¢æŠ˜åƒ¹% (æœ€å¤§)</label>
                    <input type="number" id="filter-premium-max" placeholder="ä¾‹: 50">
                </div>
                <div class="filter-group">
                    <label>å‰©é¤˜å¹´æœŸ (æœ€å°)</label>
                    <input type="number" step="0.1" id="filter-years-min" placeholder="ä¾‹: 0.5">
                </div>
                <div class="filter-group">
                    <label>å‰©é¤˜å¹´æœŸ (æœ€å¤§)</label>
                    <input type="number" step="0.1" id="filter-years-max" placeholder="ä¾‹: 3">
                </div>
                <div class="filter-group">
                    <label>ä¿¡ç”¨è©•ç­‰</label>
                    <select id="filter-rating">
                        <option value="">å…¨éƒ¨è©•ç­‰</option>
                    </select>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="applyFilters()">å¥—ç”¨ç¯©é¸</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">é‡è¨­</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="filter-table">
                    <thead>
                        <tr>
                            <th>ä»£ç¢¼</th>
                            <th>åç¨±</th>
                            <th>ç”¢æ¥­</th>
                            <th>CBåƒè€ƒåƒ¹</th>
                            <th>è½‰æ›åƒ¹æ ¼</th>
                            <th>æº¢æŠ˜åƒ¹%</th>
                            <th>å‰©é¤˜å¹´æœŸ</th>
                            <th>æ›ç‰Œæœ€é«˜</th>
                            <th>æ›ç‰Œæœ€ä½</th>
                            <th>é«˜ä½æŒ¯å¹…%</th>
                            <th>æ³¢å‹•ç‡120å¤©</th>
                            <th>æ³¢å‹•ç‡240å¤©</th>
                            <th>ä¿¡è©•</th>
                        </tr>
                    </thead>
                    <tbody id="filter-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- è´–å›è³‡è¨Š -->
        <div id="redeem" class="tab-content">
            <div class="alert alert-warning">
                <span>âš ï¸</span>
                <div>
                    <strong>é‡è¦æé†’ï¼š</strong>ä»¥ä¸‹ç‚ºå…¬å¸å·²åŸ·è¡Œæˆ–å³å°‡åŸ·è¡Œè´–å›æ¬Šçš„å¯è½‰å‚µ,è«‹æ³¨æ„ASOåˆ°æœŸæ—¥
                </div>
            </div>
            <div class="table-wrapper">
                <table id="redeem-table">
                    <thead>
                        <tr>
                            <th>å…¬å¸ä»£è™Ÿ</th>
                            <th>å…¬å¸åç¨±</th>
                            <th>ç”³å ±æ—¥æœŸ</th>
                            <th>ASOåˆ°æœŸæ—¥</th>
                            <th>ä¸»æ—¨</th>
                        </tr>
                    </thead>
                    <tbody id="redeem-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- åœæ­¢è½‰æ› -->
        <div id="stop" class="tab-content">
            <div class="alert alert-info">
                <span>â„¹ï¸</span>
                <div>
                    <strong>åœæ­¢è½‰æ›æœŸé–“ï¼š</strong>ä»¥ä¸‹å¯è½‰å‚µåœ¨æŒ‡å®šæœŸé–“ç„¡æ³•é€²è¡Œè½‰æ›
                </div>
            </div>
            <div class="table-wrapper">
                <table id="stop-table">
                    <thead>
                        <tr>
                            <th>å‚µåˆ¸ä»£ç¢¼</th>
                            <th>å‚µåˆ¸ç°¡ç¨±</th>
                            <th>åœæ­¢è½‰æ›èµ·æ—¥</th>
                            <th>åœæ­¢è½‰æ›è¿„æ—¥</th>
                            <th>åœæ­¢è½‰æ›äº‹ç”±</th>
                        </tr>
                    </thead>
                    <tbody id="stop-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- æµé€šé¤˜é¡ -->
        <div id="balance" class="tab-content">
            <div class="stats-grid" id="balance-stats-grid"></div>
            <div class="table-wrapper">
                <table id="balance-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">è­‰åˆ¸ä»£è™Ÿ</th>
                            <th style="width: 100px;">è­‰åˆ¸åç¨±</th>
                            <th style="width: 80px; cursor: pointer;" onclick="sortBalanceTable('æœ¬é€±è‚¡é¡')" title="é»æ“Šæ’åº">
                                æœ¬é€±è‚¡é¡ <span id="sort-balance-current">â‡…</span>
                            </th>
                            <th style="width: 80px;">ä¸Šé€±è‚¡é¡</th>
                            <th style="width: 80px; cursor: pointer;" onclick="sortBalanceTable('å¢æ¸›æ•¸é¡')" title="é»æ“Šæ’åº">
                                å¢æ¸›æ•¸é¡ <span id="sort-balance-change">â‡…</span>
                            </th>
                            <th style="width: 80px; cursor: pointer;" onclick="sortBalanceTable('å¢æ¸›æ¯”ç‡')" title="é»æ“Šæ’åº">
                                å¢æ¸›æ¯”ç‡% <span id="sort-balance-ratio">â‡…</span>
                            </th>
                            <th style="width: 80px;">å‰©é¤˜æ¯”ç‡%</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€é«˜</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€ä½</th>
                            <th style="width: 70px;">é«˜ä½æŒ¯å¹…%</th>
                        </tr>
                    </thead>
                    <tbody id="balance-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- åƒ¹æ ¼èª¿æ•´ -->
        <div id="adjust" class="tab-content">
            <div class="alert alert-warning">
                <span>âš ï¸</span>
                <div>
                    <strong>è½‰æ›åƒ¹æ ¼èª¿æ•´ï¼š</strong>ä»¥ä¸‹å¯è½‰å‚µçš„è½‰æ›åƒ¹æ ¼å·²èª¿æ•´æˆ–å³å°‡èª¿æ•´
                </div>
            </div>
            <div class="table-wrapper">
                <table id="adjust-table">
                    <thead>
                        <tr>
                            <th>å…¬å¸ä»£è™Ÿ</th>
                            <th>å…¬å¸åç¨±</th>
                            <th>èª¿æ•´è³‡è¨Š</th>
                        </tr>
                    </thead>
                    <tbody id="adjust-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- æ¯æ—¥è¡Œæƒ… -->
        <div id="daily" class="tab-content">
            <div class="table-wrapper">
                <table id="daily-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">ä»£ç¢¼</th>
                            <th style="width: 80px;">åç¨±</th>
                            <th style="width: 80px;">ç”¢æ¥­</th>
                            <th style="width: 70px;">CBæ”¶ç›¤åƒ¹</th>
                            <th style="width: 70px;">æˆäº¤é‡</th>
                            <th style="width: 70px;">è‚¡åƒ¹</th>
                            <th style="width: 70px;">è½‰æ›åƒ¹æ ¼</th>
                            <th style="width: 70px;">è½‰æ›åƒ¹å€¼</th>
                            <th style="width: 80px;">æº¢æŠ˜åƒ¹%</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€é«˜</th>
                            <th style="width: 70px;">æ›ç‰Œæœ€ä½</th>
                            <th style="width: 70px;">é«˜ä½æŒ¯å¹…%</th>
                            <th style="width: 70px;">YTM</th>
                            <th style="width: 70px;">TCRI</th>
                        </tr>
                    </thead>
                    <tbody id="daily-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let workbookData = {};
        let primaryData = {};
        let priceHistoryData = {};
        let currentData = {};
        let issuedDataFull = [];
        let issuedSortOrder = {};
        let balanceSortOrder = {};

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è®€å–æª”æ¡ˆ
        window.addEventListener('load', function() {
            loadDataFiles();
        });

        async function loadDataFiles() {
            try {
                document.getElementById('data-source').textContent = 'è¼‰å…¥ä¸­...';
                
                // è¼‰å…¥å…ƒå¤§æ¯é€±CBè³‡æ–™åº«
                const response1 = await fetch('å…ƒå¤§æ¯é€±CBè³‡æ–™åº«.xlsx');
                if (response1.ok) {
                    const arrayBuffer1 = await response1.arrayBuffer();
                    const data1 = new Uint8Array(arrayBuffer1);
                    const workbook1 = XLSX.read(data1, {type: 'array'});
                    
                    workbookData = {};
                    workbook1.SheetNames.forEach(sheetName => {
                        workbookData[sheetName] = XLSX.utils.sheet_to_json(workbook1.Sheets[sheetName], {
                            raw: false,
                            defval: ''
                        });
                    });
                }

                // è¼‰å…¥CBç™¼è¡Œæ¡ˆä»¶å½™æ•´
                const response2 = await fetch('CBç™¼è¡Œæ¡ˆä»¶å½™æ•´.xlsx');
                if (response2.ok) {
                    const arrayBuffer2 = await response2.arrayBuffer();
                    const data2 = new Uint8Array(arrayBuffer2);
                    const workbook2 = XLSX.read(data2, {type: 'array'});
                    
                    primaryData = {};
                    workbook2.SheetNames.forEach(sheetName => {
                        primaryData[sheetName] = XLSX.utils.sheet_to_json(workbook2.Sheets[sheetName], {
                            raw: false,
                            defval: ''
                        });
                    });
                }

                // è¼‰å…¥CBæ­·å²æ›ç‰Œæœ€é«˜ä½åƒ¹æŸ¥è©¢
                const response3 = await fetch('CBæ­·å²æ›ç‰Œæœ€é«˜ä½åƒ¹æŸ¥è©¢.xlsx');
                if (response3.ok) {
                    const arrayBuffer3 = await response3.arrayBuffer();
                    const data3 = new Uint8Array(arrayBuffer3);
                    const workbook3 = XLSX.read(data3, {type: 'array'});
                    
                    priceHistoryData = {};
                    workbook3.SheetNames.forEach(sheetName => {
                        priceHistoryData[sheetName] = XLSX.utils.sheet_to_json(workbook3.Sheets[sheetName], {
                            raw: false,
                            defval: ''
                        });
                    });
                }

                updateTime();
                document.getElementById('data-source').textContent = 'å…ƒå¤§æ¯é€±CBè³‡æ–™åº« + CBç™¼è¡Œæ¡ˆä»¶å½™æ•´ + CBæ­·å²æ›ç‰Œæœ€é«˜ä½åƒ¹æŸ¥è©¢';
                
                loadAllData();
                loadPrimaryData();
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                document.getElementById('data-source').textContent = 'æª”æ¡ˆè¼‰å…¥å¤±æ•—,è«‹ç¢ºèªæª”æ¡ˆä½ç½®';
            }
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('update-time').textContent = 
                `æ›´æ–°æ™‚é–“: ${now.toLocaleString('zh-TW')}`;
        }

        // æ ¹æ“šä»£ç¢¼ç²å–æ­·å²åƒ¹æ ¼è³‡æ–™
        function getPriceHistory(code) {
            if (!priceHistoryData['CBæ­·å¹´æœ€é«˜æœ€ä½åƒ¹']) {
                return { highest: '-', lowest: '-', range: '-' };
            }
            
            const priceData = priceHistoryData['CBæ­·å¹´æœ€é«˜æœ€ä½åƒ¹'].find(row => 
                row['ä»£è™Ÿ'] == code
            );
            
            if (!priceData) {
                return { highest: '-', lowest: '-', range: '-' };
            }
            
            const highest = parseFloat(priceData['æ›ç‰Œæœ€é«˜']) || 0;
            const lowest = parseFloat(priceData['æ›ç‰Œæœ€ä½']) || 0;
            const range = highest && lowest ? ((highest - lowest) / lowest * 100).toFixed(2) : '-';
            
            return {
                highest: highest || '-',
                lowest: lowest || '-',
                range: range
            };
        }

        // Tabåˆ‡æ›
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        function loadAllData() {
            if (!workbookData['å ±åƒ¹å–®']) {
                alert('æ‰¾ä¸åˆ°å ±åƒ¹å–®å·¥ä½œè¡¨');
                return;
            }

            currentData.quote = workbookData['å ±åƒ¹å–®'].filter(row => row['å¯è½‰å‚µåç¨±']);
            currentData.basic = workbookData['åŸºæœ¬è³‡æ–™æª”'] || [];
            currentData.redeem = workbookData['å…¬å¸åŸ·è¡Œè´–å›æ¬Š'] || [];
            currentData.stop = workbookData['åœæ­¢è½‰æ›è³‡è¨Š'] || [];
            currentData.balance = workbookData['CBæµé€šåœ¨å¤–é¤˜é¡'] || [];
            currentData.adjust = workbookData['è½‰æ›åƒ¹æ ¼èª¿æ•´'] || [];
            currentData.daily = workbookData['CBæ¯æ—¥è¡Œæƒ…è¡¨'] || [];

            loadQuoteTable();
            loadRedeemTable();
            loadStopTable();
            loadBalanceTable();
            loadAdjustTable();
            loadDailyTable();
            loadFilterOptions();
            loadStats();
        }

        function loadPrimaryData() {
            if (!primaryData['ç™¼è¡Œæ¡ˆä»¶']) {
                alert('æ‰¾ä¸åˆ°ç™¼è¡Œæ¡ˆä»¶å·¥ä½œè¡¨');
                return;
            }

            loadPrimaryTable();
            loadIssuedTable();
        }

        function loadStats() {
            if (!currentData.quote || currentData.quote.length === 0) return;

            const totalCB = currentData.quote.length;
            const avgPremium = currentData.quote.reduce((sum, row) => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                return sum + premium;
            }, 0) / totalCB;

            const positiveCount = currentData.quote.filter(row => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                return premium > 0;
            }).length;

            const negativeCount = totalCB - positiveCount;

            const statsHTML = `
                <div class="stat-card">
                    <h3>å¯è½‰å‚µç¸½æ•¸</h3>
                    <div class="value">${totalCB}</div>
                    <div class="change">æª”</div>
                </div>
                <div class="stat-card">
                    <h3>å¹³å‡æº¢æŠ˜åƒ¹</h3>
                    <div class="value">${avgPremium.toFixed(2)}%</div>
                    <div class="change">å…¨å¸‚å ´å¹³å‡</div>
                </div>
                <div class="stat-card">
                    <h3>æº¢åƒ¹äº¤æ˜“</h3>
                    <div class="value">${positiveCount}</div>
                    <div class="change">æª” (${(positiveCount/totalCB*100).toFixed(1)}%)</div>
                </div>
                <div class="stat-card">
                    <h3>æŠ˜åƒ¹äº¤æ˜“</h3>
                    <div class="value">${negativeCount}</div>
                    <div class="change">æª” (${(negativeCount/totalCB*100).toFixed(1)}%)</div>
                </div>
            `;

            document.getElementById('stats-grid').innerHTML = statsHTML;
        }

        function loadQuoteTable() {
            const tbody = document.getElementById('quote-tbody');
            if (!currentData.quote || currentData.quote.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" class="no-data">å°šæœªè¼‰å…¥è³‡æ–™</td></tr>';
                return;
            }

            tbody.innerHTML = currentData.quote.map(row => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                const premiumClass = premium >= 0 ? 'positive' : 'negative';
                const priceHistory = getPriceHistory(row['å¯è½‰å‚µä»£ç¢¼']);
                
                return `
                    <tr>
                        <td>${row['å¯è½‰å‚µä»£ç¢¼'] || '-'}</td>
                        <td>${row['å¯è½‰å‚µåç¨±'] || '-'}</td>
                        <td>${row['ç”¢æ¥­'] || '-'}</td>
                        <td>${row['æ¬Šåˆ©é‡‘(ä½°å…ƒå ±åƒ¹)'] || '-'}</td>
                        <td>${row['ç¾è‚¡åƒè€ƒåƒ¹'] || '-'}</td>
                        <td>${row['è½‰æ›åƒ¹æ ¼'] || '-'}</td>
                        <td>${parseFloat(row['CBè½‰æ›åƒ¹å€¼'] || 0).toFixed(2)}</td>
                        <td>${row['CBåƒè€ƒåƒ¹'] || '-'}</td>
                        <td class="${premiumClass}">${premium.toFixed(2)}%</td>
                        <td>${priceHistory.highest}</td>
                        <td>${priceHistory.lowest}</td>
                        <td>${priceHistory.range}${priceHistory.range !== '-' ? '%' : ''}</td>
                        <td>${row['è‚¡åƒ¹æ³¢å‹•ç‡120å¤©%'] || '-'}</td>
                        <td>${parseFloat(row['å‰©é¤˜å¹´æœŸ'] || 0).toFixed(2)}</td>
                        <td>${row['è³£å›æ—¥æœŸ(B)'] || '-'}</td>
                        <td>${row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)'] || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadFilterOptions() {
            if (!currentData.quote) return;

            // ç”¢æ¥­é¸é …
            const industries = [...new Set(currentData.quote.map(row => row['ç”¢æ¥­']).filter(x => x))];
            const industrySelect = document.getElementById('filter-industry');
            industrySelect.innerHTML = '<option value="">å…¨éƒ¨ç”¢æ¥­</option>' + 
                industries.map(ind => `<option value="${ind}">${ind}</option>`).join('');

            // ä¿¡è©•é¸é …
            const ratings = [...new Set(currentData.quote.map(row => row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)']).filter(x => x))];
            const ratingSelect = document.getElementById('filter-rating');
            ratingSelect.innerHTML = '<option value="">å…¨éƒ¨è©•ç­‰</option>' + 
                ratings.map(rating => `<option value="${rating}">${rating}</option>`).join('');

            loadFilterTable();
        }

        function loadFilterTable() {
            const tbody = document.getElementById('filter-tbody');
            if (!currentData.quote || currentData.quote.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" class="no-data">å°šæœªè¼‰å…¥è³‡æ–™</td></tr>';
                return;
            }

            tbody.innerHTML = currentData.quote.map(row => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                const premiumClass = premium >= 0 ? 'positive' : 'negative';
                const priceHistory = getPriceHistory(row['å¯è½‰å‚µä»£ç¢¼']);
                
                return `
                    <tr>
                        <td>${row['å¯è½‰å‚µä»£ç¢¼'] || '-'}</td>
                        <td>${row['å¯è½‰å‚µåç¨±'] || '-'}</td>
                        <td>${row['ç”¢æ¥­'] || '-'}</td>
                        <td>${row['CBåƒè€ƒåƒ¹'] || '-'}</td>
                        <td>${row['è½‰æ›åƒ¹æ ¼'] || '-'}</td>
                        <td class="${premiumClass}">${premium.toFixed(2)}%</td>
                        <td>${parseFloat(row['å‰©é¤˜å¹´æœŸ'] || 0).toFixed(2)}</td>
                        <td>${priceHistory.highest}</td>
                        <td>${priceHistory.lowest}</td>
                        <td>${priceHistory.range}${priceHistory.range !== '-' ? '%' : ''}</td>
                        <td>${row['è‚¡åƒ¹æ³¢å‹•ç‡120å¤©%'] || '-'}</td>
                        <td>${row['è‚¡åƒ¹æ³¢å‹•ç‡240å¤©%'] || '-'}</td>
                        <td>${row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)'] || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function applyFilters() {
            if (!currentData.quote) return;

            const industry = document.getElementById('filter-industry').value;
            const premiumMin = parseFloat(document.getElementById('filter-premium-min').value);
            const premiumMax = parseFloat(document.getElementById('filter-premium-max').value);
            const yearsMin = parseFloat(document.getElementById('filter-years-min').value);
            const yearsMax = parseFloat(document.getElementById('filter-years-max').value);
            const rating = document.getElementById('filter-rating').value;

            const filtered = currentData.quote.filter(row => {
                if (industry && row['ç”¢æ¥­'] !== industry) return false;
                
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                if (!isNaN(premiumMin) && premium < premiumMin) return false;
                if (!isNaN(premiumMax) && premium > premiumMax) return false;
                
                const years = parseFloat(row['å‰©é¤˜å¹´æœŸ']) || 0;
                if (!isNaN(yearsMin) && years < yearsMin) return false;
                if (!isNaN(yearsMax) && years > yearsMax) return false;
                
                if (rating && row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)'] !== rating) return false;
                
                return true;
            });

            const tbody = document.getElementById('filter-tbody');
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="no-data">ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(row => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                const premiumClass = premium >= 0 ? 'positive' : 'negative';
                
                return `
                    <tr>
                        <td>${row['å¯è½‰å‚µä»£ç¢¼'] || '-'}</td>
                        <td>${row['å¯è½‰å‚µåç¨±'] || '-'}</td>
                        <td>${row['ç”¢æ¥­'] || '-'}</td>
                        <td>${row['CBåƒè€ƒåƒ¹'] || '-'}</td>
                        <td>${row['è½‰æ›åƒ¹æ ¼'] || '-'}</td>
                        <td class="${premiumClass}">${premium.toFixed(2)}%</td>
                        <td>${parseFloat(row['å‰©é¤˜å¹´æœŸ'] || 0).toFixed(2)}</td>
                        <td>${row['è‚¡åƒ¹æ³¢å‹•ç‡120å¤©%'] || '-'}</td>
                        <td>${row['è‚¡åƒ¹æ³¢å‹•ç‡240å¤©%'] || '-'}</td>
                        <td>${row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)'] || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function resetFilters() {
            document.getElementById('filter-industry').value = '';
            document.getElementById('filter-premium-min').value = '';
            document.getElementById('filter-premium-max').value = '';
            document.getElementById('filter-years-min').value = '';
            document.getElementById('filter-years-max').value = '';
            document.getElementById('filter-rating').value = '';
            loadFilterTable();
        }

        function loadRedeemTable() {
            const tbody = document.getElementById('redeem-tbody');
            if (!currentData.redeem || currentData.redeem.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ç›®å‰ç„¡è´–å›è³‡è¨Š</td></tr>';
                return;
            }

            tbody.innerHTML = currentData.redeem.map(row => `
                <tr>
                    <td>${row['å…¬å¸ä»£è™Ÿ'] || '-'}</td>
                    <td>${row['å…¬å¸åç¨±'] || '-'}</td>
                    <td>${row['ç”³å ±æ—¥æœŸ'] || '-'}</td>
                    <td>${row['ASOåˆ°æœŸæ—¥'] || '-'}</td>
                    <td style="max-width: 500px;">${row['ä¸»æ—¨'] || '-'}</td>
                </tr>
            `).join('');
        }

        function loadStopTable() {
            const tbody = document.getElementById('stop-tbody');
            if (!currentData.stop || currentData.stop.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ç›®å‰ç„¡åœæ­¢è½‰æ›è³‡è¨Š</td></tr>';
                return;
            }

            // å¾ç¬¬äºŒåˆ—é–‹å§‹è®€å–(è·³éç¬¬ä¸€åˆ—çš„æ—¥æœŸæ¨™é¡Œ)
            const dataRows = currentData.stop.slice(1).filter(row => {
                const firstCol = Object.values(row)[0];
                return firstCol && firstCol !== 'å‚µåˆ¸ä»£ç¢¼';
            });

            if (dataRows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">ç›®å‰ç„¡åœæ­¢è½‰æ›è³‡è¨Š</td></tr>';
                return;
            }

            tbody.innerHTML = dataRows.map(row => {
                const values = Object.values(row);
                return `
                    <tr>
                        <td>${values[0] || '-'}</td>
                        <td>${values[1] || '-'}</td>
                        <td>${values[2] || '-'}</td>
                        <td>${values[3] || '-'}</td>
                        <td>${values[4] || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadBalanceTable() {
            const tbody = document.getElementById('balance-tbody');
            if (!currentData.balance || currentData.balance.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="no-data">å°šæœªè¼‰å…¥è³‡æ–™</td></tr>';
                return;
            }

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const decreaseData = currentData.balance
                .filter(row => parseFloat(row['å¢æ¸›æ•¸é¡']) < 0)
                .sort((a, b) => parseFloat(a['å¢æ¸›æ•¸é¡']) - parseFloat(b['å¢æ¸›æ•¸é¡']));
            
            const maxDecrease = decreaseData[0];
            const maxDecreaseRatio = currentData.balance
                .filter(row => parseFloat(row['å¢æ¸›æ¯”ç‡']) < 0)
                .sort((a, b) => parseFloat(a['å¢æ¸›æ¯”ç‡']) - parseFloat(b['å¢æ¸›æ¯”ç‡']))[0];

            let statsHTML = '';
            if (maxDecrease) {
                statsHTML = `
                    <div class="stat-card">
                        <h3>æ¸›å°‘å¼µæ•¸æœ€å¤š</h3>
                        <div class="value">${maxDecrease['è­‰åˆ¸åç¨±']}</div>
                        <div class="change">${maxDecrease['å¢æ¸›æ•¸é¡']}å¼µ</div>
                    </div>
                `;
            }
            if (maxDecreaseRatio) {
                statsHTML += `
                    <div class="stat-card">
                        <h3>æ¸›å¹…æ¯”ç‡æœ€å¤§</h3>
                        <div class="value">${maxDecreaseRatio['è­‰åˆ¸åç¨±']}</div>
                        <div class="change">${maxDecreaseRatio['å¢æ¸›æ¯”ç‡']}%</div>
                    </div>
                `;
            }
            
            const totalDecrease = decreaseData.reduce((sum, row) => 
                sum + Math.abs(parseFloat(row['å¢æ¸›æ•¸é¡']) || 0), 0);
            
            statsHTML += `
                <div class="stat-card">
                    <h3>æœ¬é€±ç¸½è½‰æ›å¼µæ•¸</h3>
                    <div class="value">${totalDecrease.toFixed(0)}</div>
                    <div class="change">å¼µ</div>
                </div>
                <div class="stat-card">
                    <h3>æœ‰è½‰æ›çš„CBæ•¸</h3>
                    <div class="value">${decreaseData.length}</div>
                    <div class="change">æª”</div>
                </div>
            `;

            document.getElementById('balance-stats-grid').innerHTML = statsHTML;

            tbody.innerHTML = currentData.balance.map(row => {
                const change = parseFloat(row['å¢æ¸›æ•¸é¡']) || 0;
                let changeClass = change > 0 ? 'new-listing' : change < 0 ? 'negative' : '';
                const priceHistory = getPriceHistory(row['è­‰åˆ¸ä»£è™Ÿ']);
                const changeNote = change > 0 ? ' (å‰›æ›ç‰Œ)' : '';
                
                return `
                    <tr>
                        <td>${row['è­‰åˆ¸ä»£è™Ÿ'] || '-'}</td>
                        <td>${row['è­‰åˆ¸åç¨±'] || '-'}</td>
                        <td>${row['æœ¬é€±è‚¡é¡'] || '-'}</td>
                        <td>${row['ä¸Šé€±è‚¡é¡'] || '-'}</td>
                        <td class="${changeClass}">${row['å¢æ¸›æ•¸é¡'] || '0'}${changeNote}</td>
                        <td class="${changeClass}">${row['å¢æ¸›æ¯”ç‡'] || '0'}</td>
                        <td>${row['ç™¼è¡Œæ¯”ç‡(å‰©é¤˜æ¯”ç‡)'] || '-'}</td>
                        <td>${priceHistory.highest}</td>
                        <td>${priceHistory.lowest}</td>
                        <td>${priceHistory.range}${priceHistory.range !== '-' ? '%' : ''}</td>
                    </tr>
                `;
            }).join('');
        }

        function sortBalanceTable(column) {
            if (!balanceSortOrder[column]) {
                balanceSortOrder[column] = 'desc'; // é è¨­é™åº
            } else {
                balanceSortOrder[column] = balanceSortOrder[column] === 'asc' ? 'desc' : 'asc';
            }
            
            const order = balanceSortOrder[column];
            const tbody = document.getElementById('balance-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            const columnIndex = {
                'æœ¬é€±è‚¡é¡': 2,
                'å¢æ¸›æ•¸é¡': 4,
                'å¢æ¸›æ¯”ç‡': 5
            };
            
            const idx = columnIndex[column];
            
            rows.sort((a, b) => {
                let aVal = a.cells[idx].textContent.replace(' (å‰›æ›ç‰Œ)', '');
                let bVal = b.cells[idx].textContent.replace(' (å‰›æ›ç‰Œ)', '');
                
                const aNum = parseFloat(aVal) || 0;
                const bNum = parseFloat(bVal) || 0;
                return order === 'asc' ? aNum - bNum : bNum - aNum;
            });
            
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
            
            // æ›´æ–°æ’åºåœ–ç¤º
            document.querySelectorAll('[id^="sort-balance-"]').forEach(el => el.textContent = 'â‡…');
            const sortIconMap = {
                'æœ¬é€±è‚¡é¡': 'sort-balance-current',
                'å¢æ¸›æ•¸é¡': 'sort-balance-change',
                'å¢æ¸›æ¯”ç‡': 'sort-balance-ratio'
            };
            const iconId = sortIconMap[column];
            if (iconId) {
                document.getElementById(iconId).textContent = order === 'asc' ? 'â†‘' : 'â†“';
            }
        }

        function loadAdjustTable() {
            const tbody = document.getElementById('adjust-tbody');
            if (!currentData.adjust || currentData.adjust.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="no-data">ç›®å‰ç„¡åƒ¹æ ¼èª¿æ•´è³‡è¨Š</td></tr>';
                return;
            }

            tbody.innerHTML = currentData.adjust.map(row => `
                <tr>
                    <td>${row['å…¬å¸ä»£è™Ÿ'] || '-'}</td>
                    <td>${row['å…¬å¸åç¨±'] || '-'}</td>
                    <td style="max-width: 600px;">${row['ä¸»æ—¨'] || '-'}</td>
                </tr>
            `).join('');
        }

        function loadDailyTable() {
            const tbody = document.getElementById('daily-tbody');
            if (!currentData.daily || currentData.daily.length === 0) {
                tbody.innerHTML = '<tr><td colspan="14" class="no-data">å°šæœªè¼‰å…¥è³‡æ–™</td></tr>';
                return;
            }

            tbody.innerHTML = currentData.daily.map(row => {
                const premium = parseFloat(row['æº¢(æŠ˜)åƒ¹%']) || 0;
                const premiumClass = premium >= 0 ? 'positive' : 'negative';
                const priceHistory = getPriceHistory(row['ä»£ç¢¼']);
                
                return `
                    <tr>
                        <td>${row['ä»£ç¢¼'] || '-'}</td>
                        <td>${row['åç¨±  '] || row['åç¨±'] || '-'}</td>
                        <td>${row['ç”¢æ¥­'] || '-'}</td>
                        <td>${row['CBæ”¶ç›¤åƒ¹'] || '-'}</td>
                        <td>${row['æˆäº¤é‡'] || '-'}</td>
                        <td>${row['è‚¡åƒ¹'] || '-'}</td>
                        <td>${row['è½‰æ›åƒ¹æ ¼'] || '-'}</td>
                        <td>${parseFloat(row['è½‰æ›åƒ¹å€¼'] || 0).toFixed(2)}</td>
                        <td class="${premiumClass}">${premium.toFixed(2)}%</td>
                        <td>${priceHistory.highest}</td>
                        <td>${priceHistory.lowest}</td>
                        <td>${priceHistory.range}${priceHistory.range !== '-' ? '%' : ''}</td>
                        <td>${row['YTM'] || '-'}</td>
                        <td>${row['TCRI'] || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadPrimaryTable() {
            const tbody = document.getElementById('primary-tbody');
            const boardTbody = document.getElementById('board-tbody');
            
            if (!primaryData['ç™¼è¡Œæ¡ˆä»¶']) {
                tbody.innerHTML = '<tr><td colspan="15" class="no-data">å°šæœªè¼‰å…¥åˆç´šå¸‚å ´è³‡æ–™</td></tr>';
                boardTbody.innerHTML = '<tr><td colspan="10" class="no-data">å°šæœªè¼‰å…¥è‘£äº‹æœƒå…¬å‘Šè³‡æ–™</td></tr>';
                return;
            }

            // éæ¿¾æ‰æ¨™é¡Œåˆ—
            const allRows = primaryData['ç™¼è¡Œæ¡ˆä»¶'].filter((row, index) => {
                return index > 0 && row['å…ƒå¤§è­‰å‚µåˆ¸éƒ¨CBåˆç´šæ¡ˆä»¶å½™æ•´è¡¨'];
            });

            // åˆ†é›¢è©¢åœˆ/ç«¶æ‹æ¡ˆä»¶å’Œè‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶
            const activeRows = allRows.filter(row => {
                const keys = Object.keys(row);
                const type = row[keys[1]]; // è©¢åœˆ/ç«¶æ‹æ¬„ä½
                return type === 'è©¢åœˆ' || type === 'ç«¶æ‹';
            });

            const boardRows = allRows.filter(row => {
                const keys = Object.keys(row);
                const type = row[keys[1]]; // è©¢åœˆ/ç«¶æ‹æ¬„ä½
                return !type || (type !== 'è©¢åœˆ' && type !== 'ç«¶æ‹');
            });

            // è¼‰å…¥è©¢åœˆ/ç«¶æ‹æ¡ˆä»¶
            if (activeRows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="15" class="no-data">ç›®å‰ç„¡é€²è¡Œä¸­çš„æ¡ˆä»¶</td></tr>';
            } else {
                tbody.innerHTML = activeRows.map(row => {
                    const keys = Object.keys(row);
                    return `
                        <tr>
                            <td>${row[keys[0]] || '-'}</td>
                            <td>${row[keys[2]] || '-'}</td>
                            <td>${row[keys[1]] || '-'}</td>
                            <td>${row[keys[4]] || '-'}</td>
                            <td>${row[keys[5]] || '-'}</td>
                            <td>${row[keys[6]] || '-'}</td>
                            <td>${row[keys[8]] || '-'}</td>
                            <td>${row[keys[9]] || '-'}</td>
                            <td>${row[keys[10]] || '-'}</td>
                            <td>${row[keys[11]] || '-'}</td>
                            <td>${row[keys[12]] || '-'}</td>
                            <td>${row[keys[14]] || '-'}</td>
                            <td>${row[keys[15]] || '-'}</td>
                            <td>${row[keys[16]] || '-'}</td>
                            <td>${row[keys[20]] || '-'}</td>
                        </tr>
                    `;
                }).join('');
            }

            // è¼‰å…¥è‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶
            if (boardRows.length === 0) {
                boardTbody.innerHTML = '<tr><td colspan="10" class="no-data">ç›®å‰ç„¡è‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶</td></tr>';
            } else {
                boardTbody.innerHTML = boardRows.map(row => {
                    const keys = Object.keys(row);
                    return `
                        <tr>
                            <td>${row[keys[0]] || '-'}</td>
                            <td>${row[keys[2]] || '-'}</td>
                            <td>${row[keys[3]] || '-'}</td>
                            <td>${row[keys[4]] || '-'}</td>
                            <td>${row[keys[5]] || '-'}</td>
                            <td>${row[keys[6]] || '-'}</td>
                            <td>${row[keys[8]] || '-'}</td>
                            <td>${row[keys[9]] || '-'}</td>
                            <td>${row[keys[10]] || '-'}</td>
                            <td>${row[keys[20]] || '-'}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function loadIssuedTable() {
            const tbody = document.getElementById('issued-tbody');
            if (!primaryData['å·²ç™¼è¡Œ']) {
                tbody.innerHTML = '<tr><td colspan="14" class="no-data">å°šæœªè¼‰å…¥å·²ç™¼è¡Œè³‡æ–™</td></tr>';
                return;
            }

            issuedDataFull = primaryData['å·²ç™¼è¡Œ'].filter(row => row['ä»£ç¢¼']);

            if (issuedDataFull.length === 0) {
                tbody.innerHTML = '<tr><td colspan="14" class="no-data">ç„¡å·²ç™¼è¡Œè³‡æ–™</td></tr>';
                return;
            }

            // è¨ˆç®—æ—¥æœŸç¯„åœ
            const dates = issuedDataFull.map(row => row['æ›ç‰Œæ—¥æœŸ']).filter(d => d);
            if (dates.length > 0) {
                const sortedDates = dates.sort();
                document.getElementById('issued-date-range').textContent = 
                    `(${sortedDates[0]} ~ ${sortedDates[sortedDates.length-1]})`;
            }

            // å¡«å……ç¯©é¸é¸é …
            const tcriSet = new Set(issuedDataFull.map(row => row['TCRI/æ“”ä¿']).filter(x => x));
            const brokerSet = new Set(issuedDataFull.map(row => row['ä¸»è¾¦åˆ¸å•†']).filter(x => x));
            
            document.getElementById('issued-filter-tcri').innerHTML = '<option value="">å…¨éƒ¨</option>' +
                Array.from(tcriSet).sort().map(t => `<option value="${t}">${t}</option>`).join('');
            
            document.getElementById('issued-filter-broker').innerHTML = '<option value="">å…¨éƒ¨åˆ¸å•†</option>' +
                Array.from(brokerSet).sort().map(b => `<option value="${b}">${b}</option>`).join('');

            renderIssuedTable(issuedDataFull);
        }

        function renderIssuedTable(data) {
            const tbody = document.getElementById('issued-tbody');
            tbody.innerHTML = data.map(row => `
                <tr>
                    <td>${row['ä»£ç¢¼'] || '-'}</td>
                    <td>${row['ç™¼è¡Œæ¨™çš„'] || '-'}</td>
                    <td>${row['TCRI/æ“”ä¿'] || '-'}</td>
                    <td>${row['é¡åº¦(å„„å…ƒ)'] || '-'}</td>
                    <td>${row['ä¸»è¾¦åˆ¸å•†'] || '-'}</td>
                    <td>${row['é€ä»¶æ—¥'] || '-'}</td>
                    <td>${row['ç”Ÿæ•ˆæ—¥'] || '-'}</td>
                    <td>${row['è©¢åœˆæœŸé–“'] || '-'}</td>
                    <td>${row['æº¢åƒ¹ç‡'] || '-'}</td>
                    <td>${row['è½‰æ›åƒ¹æ ¼'] || '-'}</td>
                    <td>${row['æ›ç‰Œæ—¥æœŸ'] || '-'}</td>
                    <td>${row['æ‰¿éŠ·åƒ¹æ ¼'] || '-'}</td>
                    <td>${row['å¹´æœŸ'] || '-'}</td>
                    <td>${row['è³£å›æ¢ä»¶'] || '-'}</td>
                </tr>
            `).join('');
        }

        function applyIssuedFilters() {
            let filtered = [...issuedDataFull];
            
            const name = document.getElementById('issued-filter-name').value.trim();
            if (name) {
                filtered = filtered.filter(row => 
                    (row['ç™¼è¡Œæ¨™çš„'] || '').includes(name) || 
                    (row['ä»£ç¢¼'] || '').includes(name)
                );
            }
            
            const tcri = document.getElementById('issued-filter-tcri').value;
            if (tcri) {
                filtered = filtered.filter(row => row['TCRI/æ“”ä¿'] === tcri);
            }
            
            const broker = document.getElementById('issued-filter-broker').value;
            if (broker) {
                filtered = filtered.filter(row => row['ä¸»è¾¦åˆ¸å•†'] === broker);
            }
            
            const years = document.getElementById('issued-filter-years').value;
            if (years) {
                filtered = filtered.filter(row => (row['å¹´æœŸ'] || '').includes(years));
            }
            
            const amountMin = parseFloat(document.getElementById('issued-filter-amount-min').value);
            const amountMax = parseFloat(document.getElementById('issued-filter-amount-max').value);
            if (!isNaN(amountMin)) {
                filtered = filtered.filter(row => parseFloat(row['é¡åº¦(å„„å…ƒ)'] || 0) >= amountMin);
            }
            if (!isNaN(amountMax)) {
                filtered = filtered.filter(row => parseFloat(row['é¡åº¦(å„„å…ƒ)'] || 0) <= amountMax);
            }
            
            renderIssuedTable(filtered);
        }

        function resetIssuedFilters() {
            document.getElementById('issued-filter-name').value = '';
            document.getElementById('issued-filter-tcri').value = '';
            document.getElementById('issued-filter-broker').value = '';
            document.getElementById('issued-filter-years').value = '';
            document.getElementById('issued-filter-amount-min').value = '';
            document.getElementById('issued-filter-amount-max').value = '';
            renderIssuedTable(issuedDataFull);
        }

        function sortIssuedTable(column) {
            if (!issuedSortOrder[column]) {
                issuedSortOrder[column] = 'asc';
            } else {
                issuedSortOrder[column] = issuedSortOrder[column] === 'asc' ? 'desc' : 'asc';
            }
            
            const order = issuedSortOrder[column];
            const tbody = document.getElementById('issued-tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            const columnIndex = {
                'é¡åº¦(å„„å…ƒ)': 3,
                'é€ä»¶æ—¥': 5,
                'ç”Ÿæ•ˆæ—¥': 6,
                'æº¢åƒ¹ç‡': 8,
                'æ›ç‰Œæ—¥æœŸ': 10
            };
            
            const idx = columnIndex[column];
            
            rows.sort((a, b) => {
                const aVal = a.cells[idx].textContent;
                const bVal = b.cells[idx].textContent;
                
                if (column === 'é¡åº¦(å„„å…ƒ)' || column === 'æº¢åƒ¹ç‡') {
                    const aNum = parseFloat(aVal) || 0;
                    const bNum = parseFloat(bVal) || 0;
                    return order === 'asc' ? aNum - bNum : bNum - aNum;
                } else {
                    return order === 'asc' ? 
                        aVal.localeCompare(bVal) : 
                        bVal.localeCompare(aVal);
                }
            });
            
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
            
            // æ›´æ–°æ’åºåœ–ç¤º
            document.querySelectorAll('[id^="sort-"]').forEach(el => el.textContent = 'â‡…');
            const sortIconMap = {
                'é¡åº¦(å„„å…ƒ)': 'sort-amount',
                'é€ä»¶æ—¥': 'sort-senddate',
                'ç”Ÿæ•ˆæ—¥': 'sort-effectdate',
                'æº¢åƒ¹ç‡': 'sort-premium',
                'æ›ç‰Œæ—¥æœŸ': 'sort-listdate'
            };
            const iconId = sortIconMap[column];
            if (iconId) {
                document.getElementById(iconId).textContent = order === 'asc' ? 'â†‘' : 'â†“';
            }
        }

        // æ›´æ–°ç•¶å‰æ—¥æœŸ
        function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            const dateStr = now.toLocaleDateString('zh-TW', options);
            document.getElementById('current-date').textContent = dateStr;
            
            // æ›´æ–°è³‡æ–™æœŸé–“
            const updateTime = now.toLocaleString('zh-TW');
            document.getElementById('data-period').textContent = updateTime;
        }

        // ç€è¦½é‡çµ±è¨ˆ
        function updateViewCount() {
            const today = new Date().toDateString();
            const storedDate = localStorage.getItem('visitDate');
            const todayViews = parseInt(localStorage.getItem('todayViews') || '0');
            const totalViews = parseInt(localStorage.getItem('totalViews') || '0');

            if (storedDate === today) {
                localStorage.setItem('todayViews', (todayViews + 1).toString());
            } else {
                localStorage.setItem('visitDate', today);
                localStorage.setItem('todayViews', '1');
            }
            
            localStorage.setItem('totalViews', (totalViews + 1).toString());
            
            document.getElementById('today-views').textContent = localStorage.getItem('todayViews');
            document.getElementById('total-views').textContent = localStorage.getItem('totalViews');
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.addEventListener('load', function() {
            updateCurrentDate();
            updateViewCount();
        });
    </script>

    <!-- é¢¨éšªæé†’å’Œç‰ˆæ¬Šè³‡è¨Š -->
    <div style="margin: 40px 0 20px 0;">
        <!-- é‡è¦æç¤º -->
        <div style="background: linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%); border: 2px solid #f39c12; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <span style="font-size: 24px;">âš ï¸</span>
                <h3 style="margin: 0; color: #e67e22; font-size: 18px; font-weight: 700;">é‡è¦æç¤º</h3>
            </div>
            <div style="color: #5d4037; line-height: 1.8; font-size: 15px;">
                <p style="margin: 10px 0;">æœ¬ç³»çµ±æä¾›æ­·å²æ•¸æ“šçµ±è¨ˆèˆ‡è³‡æ–™æ•´ç†ï¼Œæ‰€æœ‰æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°</p>
                <p style="margin: 10px 0;">éå»è¡¨ç¾ä¸ä»£è¡¨æœªä¾†çµæœï¼ŒæŠ•è³‡æ±ºç­–è«‹è‡ªè¡Œè©•ä¼°é¢¨éšª</p>
            </div>
        </div>

        <!-- è³‡æ–™ä¾†æºå’Œç‰ˆæ¬Š -->
        <div style="background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%); border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <div style="text-align: center; margin-bottom: 15px;">
                <p style="color: #5c6bc0; font-size: 15px; margin: 8px 0;">
                    <strong>è³‡æ–™ä¾†æºï¼š</strong>è­‰åˆ¸æ«ƒæª¯è²·è³£ä¸­å¿ƒ
                </p>
                <p style="color: #e67e22; font-size: 14px; margin: 8px 0;">
                    âš ï¸ æœ¬è¡¨åƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æ±ºç­–è«‹è‡ªè¡Œè©•ä¼°é¢¨éšª
                </p>
            </div>
            
            <div style="border-top: 2px solid rgba(92, 107, 192, 0.3); padding-top: 15px; margin-top: 15px;">
                <div style="text-align: center;">
                    <p style="color: #5c6bc0; font-size: 15px; font-weight: 600; margin: 10px 0;">
                        ğŸ“š Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤
                    </p>
                    <p style="color: #7986cb; font-size: 14px; margin: 8px 0;">
                        æ›´å¤šæŠ•è³‡è§€å¿µèˆ‡CBè½‰å‚µåˆ†æï¼Œæ­¡è¿è¨‚é–±å­¸ç¿’
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 15px; flex-wrap: wrap;">
                        <a href="https://vocus.cc/user/@rexlife" target="_blank" style="color: #5c6bc0; text-decoration: none; font-size: 14px; padding: 8px 16px; background: white; border-radius: 20px; transition: all 0.3s; display: inline-block;">
                            ğŸ“ æ–¹æ ¼å­éƒ¨è½æ ¼
                        </a>
                        <a href="https://www.youtube.com/@RexCFP" target="_blank" style="color: #5c6bc0; text-decoration: none; font-size: 14px; padding: 8px 16px; background: white; border-radius: 20px; transition: all 0.3s; display: inline-block;">
                            â–¶ï¸ YouTubeé »é“
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
